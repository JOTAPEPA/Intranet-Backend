<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba Completa - Todos los M√≥dulos</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .module { background: white; margin: 20px 0; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .module h2 { color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="file"] { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-family: monospace; white-space: pre-wrap; }
        .success { border-left: 4px solid #28a745; }
        .error { border-left: 4px solid #dc3545; }
        .endpoint-list { background: #e9ecef; padding: 15px; border-radius: 4px; margin-top: 20px; }
        .endpoint-list h3 { margin-top: 0; }
        .endpoint { margin: 5px 0; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Prueba Completa de Todos los M√≥dulos con Cloudinary</h1>
        
        <!-- Lista de Endpoints -->
        <div class="endpoint-list">
            <h3>üìã Endpoints Disponibles:</h3>
            <div class="endpoint">üìä <strong>Compras:</strong> POST/GET/DELETE /api/compras</div>
            <div class="endpoint">üí∞ <strong>Contabilidad:</strong> POST/GET/DELETE /api/contabilidad</div>
            <div class="endpoint">üîç <strong>Control Interno:</strong> POST/GET/DELETE /api/control-interno</div>
            <div class="endpoint">üí≥ <strong>Cr√©dito:</strong> POST/GET/DELETE /api/credito</div>
            <div class="endpoint">üë®‚Äçüíº <strong>Gerencia:</strong> POST/GET/DELETE /api/gerencia</div>
            <div class="endpoint">‚ö†Ô∏è <strong>Riesgos:</strong> POST/GET/DELETE /api/riesgos</div>
            <div class="endpoint">üë• <strong>Talento Humano:</strong> POST/GET/DELETE /api/talento-humano</div>
            <div class="endpoint">üè¶ <strong>Tesorer√≠a:</strong> POST/GET/DELETE /api/tesoreria</div>
        </div>

        <!-- Compras -->
        <div class="module">
            <h2>üìä Compras</h2>
            <form id="comprasForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="compras-documento">Documento:</label>
                    <input type="text" id="compras-documento" value="Documento de compras" required>
                </div>
                <div class="form-group">
                    <label for="compras-files">Archivos:</label>
                    <input type="file" id="compras-files" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx">
                </div>
                <button type="submit">Subir a Compras</button>
            </form>
            <div id="compras-result" class="result" style="display: none;"></div>
        </div>

        <!-- Contabilidad -->
        <div class="module">
            <h2>üí∞ Contabilidad</h2>
            <form id="contabilidadForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="contabilidad-documento">Documento:</label>
                    <input type="text" id="contabilidad-documento" value="Documento de contabilidad" required>
                </div>
                <div class="form-group">
                    <label for="contabilidad-files">Archivos:</label>
                    <input type="file" id="contabilidad-files" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx">
                </div>
                <button type="submit">Subir a Contabilidad</button>
            </form>
            <div id="contabilidad-result" class="result" style="display: none;"></div>
        </div>

        <!-- Control Interno -->
        <div class="module">
            <h2>üîç Control Interno</h2>
            <form id="controlInternoForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="controlInterno-documento">Documento:</label>
                    <input type="text" id="controlInterno-documento" value="Documento de control interno" required>
                </div>
                <div class="form-group">
                    <label for="controlInterno-files">Archivos:</label>
                    <input type="file" id="controlInterno-files" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx">
                </div>
                <button type="submit">Subir a Control Interno</button>
            </form>
            <div id="controlInterno-result" class="result" style="display: none;"></div>
        </div>

        <!-- Cr√©dito -->
        <div class="module">
            <h2>üí≥ Cr√©dito</h2>
            <form id="creditoForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="credito-documento">Documento:</label>
                    <input type="text" id="credito-documento" value="Documento de cr√©dito" required>
                </div>
                <div class="form-group">
                    <label for="credito-files">Archivos:</label>
                    <input type="file" id="credito-files" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx">
                </div>
                <button type="submit">Subir a Cr√©dito</button>
            </form>
            <div id="credito-result" class="result" style="display: none;"></div>
        </div>

        <!-- Gerencia -->
        <div class="module">
            <h2>üë®‚Äçüíº Gerencia</h2>
            <form id="gerenciaForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="gerencia-documento">Documento:</label>
                    <input type="text" id="gerencia-documento" value="Documento de gerencia" required>
                </div>
                <div class="form-group">
                    <label for="gerencia-files">Archivos:</label>
                    <input type="file" id="gerencia-files" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx">
                </div>
                <button type="submit">Subir a Gerencia</button>
            </form>
            <div id="gerencia-result" class="result" style="display: none;"></div>
        </div>

        <!-- Riesgos -->
        <div class="module">
            <h2>‚ö†Ô∏è Riesgos</h2>
            <form id="riesgosForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="riesgos-documento">Documento:</label>
                    <input type="text" id="riesgos-documento" value="Documento de riesgos" required>
                </div>
                <div class="form-group">
                    <label for="riesgos-files">Archivos:</label>
                    <input type="file" id="riesgos-files" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx">
                </div>
                <button type="submit">Subir a Riesgos</button>
            </form>
            <div id="riesgos-result" class="result" style="display: none;"></div>
        </div>

        <!-- Talento Humano -->
        <div class="module">
            <h2>üë• Talento Humano</h2>
            <form id="talentoHumanoForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="talentoHumano-documento">Documento:</label>
                    <input type="text" id="talentoHumano-documento" value="Documento de talento humano" required>
                </div>
                <div class="form-group">
                    <label for="talentoHumano-files">Archivos:</label>
                    <input type="file" id="talentoHumano-files" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx">
                </div>
                <button type="submit">Subir a Talento Humano</button>
            </form>
            <div id="talentoHumano-result" class="result" style="display: none;"></div>
        </div>

        <!-- Tesorer√≠a -->
        <div class="module">
            <h2>üè¶ Tesorer√≠a</h2>
            <form id="tesoreriaForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="tesoreria-documento">Documento:</label>
                    <input type="text" id="tesoreria-documento" value="Documento de tesorer√≠a" required>
                </div>
                <div class="form-group">
                    <label for="tesoreria-files">Archivos:</label>
                    <input type="file" id="tesoreria-files" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx">
                </div>
                <button type="submit">Subir a Tesorer√≠a</button>
            </form>
            <div id="tesoreria-result" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        const modules = [
            'compras', 'contabilidad', 'controlInterno', 'credito', 
            'gerencia', 'riesgos', 'talentoHumano', 'tesoreria'
        ];

        const apiEndpoints = {
            'compras': '/api/compras',
            'contabilidad': '/api/contabilidad',
            'controlInterno': '/api/control-interno',
            'credito': '/api/credito',
            'gerencia': '/api/gerencia',
            'riesgos': '/api/riesgos',
            'talentoHumano': '/api/talento-humano',
            'tesoreria': '/api/tesoreria'
        };

        modules.forEach(module => {
            document.getElementById(`${module}Form`).addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData();
                const documento = document.getElementById(`${module}-documento`).value;
                const files = document.getElementById(`${module}-files`).files;
                const resultDiv = document.getElementById(`${module}-result`);
                
                // Agregar el texto del documento
                formData.append('documento', documento);
                
                // Agregar los archivos
                for (let i = 0; i < files.length; i++) {
                    formData.append('documentos', files[i]);
                }
                
                try {
                    resultDiv.style.display = 'block';
                    resultDiv.innerHTML = '‚è≥ Subiendo archivos...';
                    resultDiv.className = 'result';
                    
                    const response = await fetch(`http://localhost:5000${apiEndpoints[module]}`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        resultDiv.className = 'result success';
                        let displayText = `‚úÖ ${result.message}\n`;
                        displayText += `üìÅ Archivos subidos: ${result.filesUploaded}\n\n`;
                        
                        if (result.savedDocument && result.savedDocument.documentos) {
                            result.savedDocument.documentos.forEach((doc, index) => {
                                displayText += `üìÑ Archivo ${index + 1}: ${doc.originalName}\n`;
                                displayText += `üîó URL: ${doc.url}\n`;
                                displayText += `üìè Tama√±o: ${doc.bytes} bytes\n`;
                                displayText += `üìã Formato: ${doc.format}\n\n`;
                            });
                        }
                        
                        resultDiv.innerHTML = displayText;
                    } else {
                        resultDiv.className = 'result error';
                        resultDiv.innerHTML = `‚ùå Error: ${result.message}\n${JSON.stringify(result, null, 2)}`;
                    }
                    
                } catch (error) {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `‚ùå Error de conexi√≥n: ${error.message}`;
                }
            });
        });
    </script>
</body>
</html>
